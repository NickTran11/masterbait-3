/* ---- Base ---- */
:root{
  --bgSolid: #070711;

  /* Glass */
  --glass: rgba(255,255,255,0.06);
  --glass2: rgba(0,0,0,0.25);
  --border: rgba(255,255,255,0.12);

  /* Text */
  --text: rgba(255,255,255,0.92);
  --muted: rgba(255,255,255,0.70);

  /* Accents from reference */
  --purple: rgba(168,85,247,1);   /* #A855F7 */
  --cyan: rgba(56,189,248,1);     /* #38BDF8 */
  --accent: rgba(168,85,247,1);
}

*{ box-sizing:border-box; }

body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
  color: var(--text);
  background:
    radial-gradient(900px 560px at 20% 10%, rgba(168,85,247,0.20), transparent 60%),
    radial-gradient(900px 560px at 80% 70%, rgba(56,189,248,0.14), transparent 65%),
    var(--bgSolid);
  min-height:100vh;
}

/* ---- Top bar ---- */
.top-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding: 14px 18px;
  border-bottom: 1px solid var(--border);
  background: rgba(0,0,0,0.25);
  backdrop-filter: blur(10px);
}

.top-bar h1{
  margin:0;
  font-size:28px;
  letter-spacing:0.4px;
}

.progress{
  color: var(--muted);
  font-size:14px;
}

/* ---- Main layout ---- */
.main-container{
  display:grid;
  grid-template-columns: 1fr 340px;
  gap: 28px;
  padding: 34px 40px;
}

.path{ position:absolute; inset:0; pointer-events:none; }

/* ---- Map container (game-like) ---- */
.map-container{
  position:relative;
  min-height: 420px;
  border-radius: 18px;
  border: 1px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.06);
  box-shadow: 0 18px 60px rgba(0,0,0,0.35);
  backdrop-filter: blur(10px);
  overflow:hidden;
}

/* =============================== */
/* Mystic Nebula Ambient Pack      */
/* =============================== */

/* Ensure map container can layer stuff cleanly */
.map-container{
  position: relative; /* you already have this */
}

/* Put decor behind nodes but above background */
.map-nebula,
.map-particles{
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 0; /* decor layer */
}

/* Make sure your actual content sits above decor */
.path,
.level-node,
.level-label,
.level-rating{
  position: absolute;
  z-index: 2;
}

/* If your SVG path isn't positioned as absolute already, keep it */
.path{ z-index: 1; }

/* ---------- Nebula blobs ---------- */
.map-nebula{
  filter: blur(10px);
  opacity: 0.95;
}

/* Use pseudo blobs so you don‚Äôt need extra HTML */
.map-nebula::before,
.map-nebula::after{
  content:"";
  position:absolute;
  inset:-25%;
  background:
    radial-gradient(380px 260px at 18% 30%, rgba(168,85,247,0.18), transparent 70%),
    radial-gradient(420px 300px at 72% 40%, rgba(56,189,248,0.14), transparent 70%),
    radial-gradient(300px 220px at 52% 78%, rgba(168,85,247,0.10), transparent 70%),
    radial-gradient(260px 200px at 88% 82%, rgba(56,189,248,0.08), transparent 70%);
  transform: translate3d(0,0,0);
  animation: nebulaDriftA 22s ease-in-out infinite;
}

.map-nebula::after{
  opacity: 0.65;
  filter: blur(16px);
  background:
    radial-gradient(520px 360px at 22% 70%, rgba(56,189,248,0.12), transparent 70%),
    radial-gradient(520px 360px at 78% 30%, rgba(168,85,247,0.14), transparent 70%),
    radial-gradient(360px 260px at 55% 45%, rgba(255,255,255,0.04), transparent 70%);
  animation: nebulaDriftB 28s ease-in-out infinite;
}

@keyframes nebulaDriftA{
  0%   { transform: translate(-2%, -1%) scale(1); }
  50%  { transform: translate(2%,  1%) scale(1.03); }
  100% { transform: translate(-2%, -1%) scale(1); }
}
@keyframes nebulaDriftB{
  0%   { transform: translate(2%, 1%) scale(1.02); }
  50%  { transform: translate(-2%, -1%) scale(1.06); }
  100% { transform: translate(2%, 1%) scale(1.02); }
}

/* ===================== */
/* Parallax support */
/* ===================== */
.map-nebula,
.map-particles{
  will-change: transform;
}

/* Add parallax offsets without breaking centering */
.level-node{
  transform: translate(calc(-50% + var(--parX, 0px)), calc(-50% + var(--parY, 0px)));
}

/* Keep hover effect working with parallax offsets */
.level-node:hover{
  transform: translate(calc(-50% + var(--parX, 0px)), calc(-52% + var(--parY, 0px))) scale(1.03);
}

/* ---------- Particles ---------- */
/* We generate particles using background layers (no extra divs per particle) */
.map-particles{
  opacity: 0.75;
  mix-blend-mode: screen;
  filter: blur(0.5px);
  background:
    radial-gradient(circle at 12% 25%, rgba(255,255,255,0.20) 0 2px, transparent 3px),
    radial-gradient(circle at 22% 70%, rgba(56,189,248,0.14) 0 3px, transparent 5px),
    radial-gradient(circle at 35% 40%, rgba(168,85,247,0.16) 0 3px, transparent 5px),
    radial-gradient(circle at 48% 18%, rgba(255,255,255,0.18) 0 2px, transparent 4px),
    radial-gradient(circle at 58% 62%, rgba(56,189,248,0.12) 0 3px, transparent 5px),
    radial-gradient(circle at 66% 32%, rgba(168,85,247,0.12) 0 3px, transparent 5px),
    radial-gradient(circle at 78% 76%, rgba(255,255,255,0.06) 0 3px, transparent 5px),
    radial-gradient(circle at 15% 55%, rgba(168,85,247,0.14) 0 3px, transparent 5px),
radial-gradient(circle at 30% 82%, rgba(255,255,255,0.12) 0 3px, transparent 5px),
radial-gradient(circle at 62% 14%, rgba(56,189,248,0.16) 0 3px, transparent 5px),
radial-gradient(circle at 80% 60%, rgba(168,85,247,0.14) 0 3px, transparent 5px),
    radial-gradient(circle at 88% 22%, rgba(56,189,248,0.24) 0 3px, transparent 5px),
    radial-gradient(circle at 92% 55%, rgba(168,85,247,0.10) 0 3px, transparent 5px);
  filter: blur(0.2px);
  animation: particleFloat 18s ease-in-out infinite;
}

@keyframes particleFloat{
  0%   { transform: translate3d(0,0,0); opacity: 0.60; }
  50%  { transform: translate3d(-1.2%, -1.0%, 0); opacity: 0.85; }
  100% { transform: translate3d(0,0,0); opacity: 0.60; }
}

/* Respect reduced motion */
@media (prefers-reduced-motion: reduce){
  .map-nebula::before,
  .map-nebula::after,
  .map-particles{
    animation: none !important;
  }
}

/* soft ‚Äúmap‚Äù texture shapes */
.map-container::before{
  content:"";
  position:absolute;
  inset:-40px;
  background:
    radial-gradient(220px 140px at 20% 30%, rgba(255,255,255,0.06), transparent 70%),
    radial-gradient(260px 170px at 70% 65%, rgba(255,255,255,0.05), transparent 75%),
    radial-gradient(180px 120px at 50% 20%, rgba(255,255,255,0.03), transparent 70%);
  filter: blur(1px);
  pointer-events:none;
}

/* a curvy path line behind nodes */
.path{
  position:absolute;
  inset:0;
  pointer-events:none;
}
.path svg{
  width:100%;
  height:100%;
}
.path path{
  stroke: rgba(168,85,247,0.25);
  stroke-width: 6;
  fill: none;
  stroke-linecap: round;
  stroke-dasharray: 12 14;

  /* NEW */
  animation: dashFlow 3.2s linear infinite;
}

@keyframes dashFlow{
  to { stroke-dashoffset: -52; }
}

/* Optional: if you want it a bit calmer */
@media (prefers-reduced-motion: reduce){
  .path path{ animation: none !important; }
}

/* ---- Nodes ---- */
.level-node{
  position:absolute;
  width:68px;
  height:68px;
  border-radius: 18px;
  display:flex;
  justify-content:center;
  align-items:center;
  font-weight: 800;
  font-size: 18px;
  user-select:none;

  /* IMPORTANT: keep centering always */
  transform: translate(-50%, -50%);
  transition: transform .15s ease, box-shadow .2s ease, filter .2s ease;

  border: 1px solid rgba(255,255,255,0.14);
  background: rgba(255,255,255,0.06);
  box-shadow: 0 10px 22px rgba(0,0,0,0.35);
}

/* hover should ADD to centering, not replace it */
.level-node:hover{
  transform: translate(-50%, -52%) scale(1.03);
}

/* states */
.level-node.available{
  background: linear-gradient(180deg, rgba(120,88,255,0.95), rgba(59,130,246,0.9));
  box-shadow: 0 0 0 6px rgba(120,88,255,0.18), 0 18px 40px rgba(59,130,246,0.18);
  cursor:pointer;
}

.level-node.current{
  background: linear-gradient(180deg, rgba(59,130,246,1), rgba(37,99,235,0.95));
  box-shadow: 0 0 0 6px rgba(59,130,246,0.18), 0 18px 40px rgba(59,130,246,0.25);
  animation: pulse 1.6s ease-in-out infinite;
  cursor:pointer;
}

@keyframes pulse{
  0%,100%{ filter: brightness(1); }
  50%{ filter: brightness(1.15); }
}

.level-node.locked{
  background: rgba(148,163,184,0.18);
  color: rgba(229,231,235,0.75);
  cursor:not-allowed;
  filter: grayscale(20%);
}

.level-node.completed{
  background: linear-gradient(180deg, rgba(34,197,94,0.95), rgba(22,163,74,0.9));
  box-shadow: 0 16px 34px rgba(34,197,94,0.18);
  cursor:pointer;
}

.level-node.locked::after{
  content: "üîí";
  position:absolute;
  bottom: -10px;
  right: -10px;
  font-size: 14px;
  opacity: 0.85;
}

.level-node.selected{
  box-shadow:
    0 0 0 6px rgba(255,255,255,0.08),
    0 0 0 10px rgba(59,130,246,0.18),
    0 18px 40px rgba(59,130,246,0.22);
  outline: 1px solid rgba(255,255,255,0.18);
}

/* ===================== */
/* Unlock Animation (Demo) */
/* ===================== */

/* Smooth lock fade when unlocking */
.level-node.locked::after{
  transition: opacity .22s ease, transform .22s ease;
}

/* Temporary unlocking state */
.level-node.unlocking{
  filter: brightness(1.15) saturate(1.15);
  box-shadow:
    0 0 0 6px rgba(255,255,255,0.08),
    0 0 0 10px rgba(168,85,247,0.22),
    0 18px 40px rgba(56,189,248,0.18);
}

/* Lock icon fades out */
.level-node.unlocking::after{
  opacity: 0;
  transform: translateY(6px) scale(0.9);
}

/* Sparkle burst */
.level-node.unlocking::before{
  content:"";
  position:absolute;
  inset:-26px;
  border-radius: 26px;
  pointer-events:none;

  background:
    radial-gradient(circle at 35% 30%, rgba(255,255,255,0.95) 0 2px, transparent 7px),
    radial-gradient(circle at 70% 25%, rgba(56,189,248,0.85) 0 2px, transparent 8px),
    radial-gradient(circle at 30% 70%, rgba(168,85,247,0.85) 0 2px, transparent 8px),
    radial-gradient(circle at 75% 75%, rgba(255,255,255,0.80) 0 2px, transparent 8px);

  opacity: 0;
  transform: scale(0.9);
  animation: sparkleBurst .45s ease forwards;
}

@keyframes sparkleBurst{
  0%   { opacity: 0; transform: scale(0.85); }
  30%  { opacity: 1; transform: scale(1.05); }
  100% { opacity: 0; transform: scale(1.25); }
}

/* labels */
.level-label{
  position:absolute;
  transform: translate(-50%, 0);
  font-size: 12px;
  color: var(--muted);
  white-space: nowrap;
  opacity: 0.95;
}

/* Rating row */
.level-rating{
  position: absolute;
  display: flex;
  gap: 6px;
  transform: translate(-50%, -50%);
  pointer-events: none;
}

/* Slot controls filled vs empty */
.rod-slot{
  width: 16px;
  height: 16px;
  opacity: 0.35;
  filter: grayscale(100%);
}

.rod-slot.filled{
  opacity: 1;
  filter: none;
}

.rod-icon{
  width: 16px;
  height: 16px;
  stroke: rgba(229,231,235,0.95);
  stroke-width: 2.2;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}

/* Gold for earned */
.rod-slot.filled .rod-icon{
  stroke: rgba(245,158,11,0.95);
  filter: drop-shadow(0 0 6px rgba(245,158,11,0.35));
}


/* ---- Right panel as mission card ---- */
.level-info{
  background: var(--glass);
  border: 1px solid var(--border);
  border-radius: 18px;
  padding: 20px;
  box-shadow: 0 18px 60px rgba(0,0,0,0.35);
  backdrop-filter: blur(10px);
}

.level-info h2{
  margin: 4px 0 10px;
  font-size: 20px;
}

.level-info p{
  margin: 0 0 14px;
  color: var(--muted);
  line-height: 1.4;
}

.chips{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  margin: 10px 0 14px;
}

.chip{
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  background: rgba(255,255,255,0.08);
  border: 1px solid rgba(255,255,255,0.12);
  color: var(--text);
}

.start-btn{
  width:100%;
  margin-top: 14px;
  padding: 12px 14px;
  border: none;
  border-radius: 14px;
  background: linear-gradient(135deg, rgba(168,85,247,0.95), rgba(56,189,248,0.75));
  color: rgba(0,0,0,0.85);
  font-weight: 800;
  cursor: pointer;
  transition: transform .15s ease, filter .2s ease;
}
.start-btn:hover{ transform: translateY(-1px); filter: brightness(1.05); }
.start-btn:active{ transform: translateY(0px) scale(0.99); }

.start-btn:disabled{
  opacity: 0.55;
  cursor: not-allowed;
  filter: grayscale(15%);
}
/* responsive */
@media (max-width: 950px){
  .main-container{
    grid-template-columns: 1fr;
  }
}

/* ===================== */
/* Level Launch Animation */
/* ===================== */
/* Page dim/blur during launch */
body.launching .map-container,
body.launching .level-info,
body.launching .top-bar{
  filter: blur(2px) brightness(0.85);
  transition: filter 0.35s ease;
}

/* Keep the launching node crisp and above everything */
.level-node.launching{
  z-index: 50;
  animation: nodeLaunch 0.45s ease forwards;
}

@keyframes nodeLaunch{
  0%   { transform: translate(-50%, -50%) scale(1); }
  60%  { transform: translate(-50%, -55%) scale(1.35); }
  100% { transform: translate(-50%, -50%) scale(1.25); }
}

/* Optional: subtle ripple */
.level-node.launching::before{
  content:"";
  position:absolute;
  inset:-18px;
  border-radius: 24px;
  border: 2px solid rgba(255,255,255,0.20);
  opacity: 0;
  animation: ripple 0.45s ease forwards;
}

@keyframes ripple{
  0%   { transform: scale(0.85); opacity: 0; }
  40%  { opacity: 1; }
  100% { transform: scale(1.15); opacity: 0; }
}